From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Xymb <xymb@endcrystal.me>
Date: Fri, 9 Aug 2024 06:33:40 +0200
Subject: [PATCH] Exploit: Prevent teleportAccept prediction to fight flight
 exploits


diff --git a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index 804166bf2da81927ab449811be9fcf67e74eed00..5ff10164c458dc628046f1e4aaa6ea1711a1a990 100644
--- a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -1804,6 +1804,7 @@ public class ServerGamePacketListenerImpl extends ServerCommonPacketListenerImpl
         float f3 = set.contains(RelativeMovement.X_ROT) ? this.player.getXRot() : 0.0F;
 
         this.awaitingPositionFromClient = new Vec3(d0, d1, d2);
+        this.awaitingTeleport += java.util.concurrent.ThreadLocalRandom.current().nextInt(1, Integer.MAX_VALUE - 2); // Abomination - prevent teleportAccept-based flight exploits
         if (++this.awaitingTeleport == Integer.MAX_VALUE) {
             this.awaitingTeleport = 0;
         }

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Xymb <xymb@endcrystal.me>
Date: Wed, 4 Sep 2024 07:37:57 +0200
Subject: [PATCH] Network performance: Disable entity motion packets


diff --git a/src/main/java/abomination/config/Networking.java b/src/main/java/abomination/config/Networking.java
index da615876d8b73547daa86130c47362d819c05f0f..23fb47ad0377762bd5aa237a488677eae8bd56ad 100644
--- a/src/main/java/abomination/config/Networking.java
+++ b/src/main/java/abomination/config/Networking.java
@@ -2,4 +2,5 @@ package abomination.config;
 
 public class Networking {
     public static boolean useAlternativeKeepAlive = false;
+    public static boolean disableEntityMotionPackets = false; // Almost always unnecessary spammy packet, best turn on
 }
diff --git a/src/main/java/net/minecraft/server/level/ServerEntity.java b/src/main/java/net/minecraft/server/level/ServerEntity.java
index 8ea2f24695f5dad55e21f238b69442513e7a90c6..35543e7b770418df33b5187d687da6b1ab28d67b 100644
--- a/src/main/java/net/minecraft/server/level/ServerEntity.java
+++ b/src/main/java/net/minecraft/server/level/ServerEntity.java
@@ -214,6 +214,7 @@ public class ServerEntity {
                     flag5 = true;
                 }
 
+                if (abomination.config.Networking.disableEntityMotionPackets) { // Abomination
                 if ((this.trackDelta || this.entity.hasImpulse || this.entity instanceof LivingEntity && ((LivingEntity) this.entity).isFallFlying()) && this.tickCount > 0) {
                     Vec3 vec3d1 = this.entity.getDeltaMovement();
                     double d0 = vec3d1.distanceToSqr(this.lastSentMovement);
@@ -231,6 +232,7 @@ public class ServerEntity {
                         }
                     }
                 }
+                } // Abomination
 
                 if (packet1 != null) {
                     this.broadcast.accept(packet1);
